# 摄像头使用说明

## 问题说明

在 Docker 容器中，由于安全限制，无法直接访问宿主机的摄像头设备。这导致 KNN 摄像头识别应用无法正常工作。

## 解决方案

### 方案1：使用网络摄像头服务器（推荐）

1. **安装依赖**

   ```bash
   pip install flask opencv-python
   ```
2. **启动网络摄像头服务器**

   ```bash
   python webcam_server.py
   ```

   服务器将在 `http://localhost:8080` 启动
3. **在 Streamlit 应用中使用**

   - 打开 KNN 摄像头识别应用
   - 在"摄像头源"输入框中输入：`http://localhost:8080/video`
   - 点击"启动摄像头"按钮

### 方案2：使用手机摄像头

1. **安装 IP 摄像头应用**

   - Android: "IP Webcam" 或 "DroidCam"
   - iOS: "IP Camera Lite" 或类似应用
2. **配置应用**

   - 确保手机和电脑在同一网络
   - 启动应用并获取摄像头URL
   - 通常格式为：`http://手机IP:端口/video`
3. **在 Streamlit 应用中使用**

   - 输入获取到的摄像头URL
   - 启动摄像头

### 方案3：使用测试视频文件

如果无法使用摄像头，可以修改应用以支持视频文件：

```python
# 在摄像头配置中添加文件上传选项
uploaded_file = st.file_uploader("上传视频文件", type=['mp4', 'avi', 'mov'])
if uploaded_file is not None:
    # 处理上传的视频文件
    pass
```

## 故障排除

### 1. 无法连接到网络摄像头

- 检查防火墙设置
- 确保端口 8080 未被占用
- 尝试使用不同的端口：`python webcam_server.py --port 8081`

### 2. 摄像头画面卡顿

- 降低帧率：修改 `webcam_server.py` 中的 `time.sleep(0.033)` 为更大的值
- 降低分辨率：在摄像头初始化后添加 `camera.set(cv2.CAP_PROP_FRAME_WIDTH, 640)`

### 3. 权限问题

- Windows: 确保应用有摄像头访问权限
- Linux: 确保用户有 `/dev/video*` 设备的访问权限

## 高级配置

### 自定义摄像头设备

```bash
# 使用不同的摄像头设备
python webcam_server.py --camera 1

# 使用不同的端口
python webcam_server.py --port 9000

# 绑定到特定IP
python webcam_server.py --host 192.168.1.100
```

### 在 Docker 中使用果需要从 Docker 容器访问宿主机的网络摄像头服务器：

1. 修改 `docker-compose.yml`，添加网络配置：

```yaml
services:
  app_blue:
    # ... 其他配置
    extra_hosts:
      - "host.docker.internal:host-gateway"
```

2. 在 Streamlit 应用中使用：

```
http://host.docker.internal:8080/video
```

## 安全注意事项

1. **网络访问控制**

   - 默认情况下，网络摄像头服务器绑定到 `0.0.0.0`，允许所有网络访问
   - 在生产环境中，建议绑定到特定IP地址
2. **防火墙配置**

   - 确保只开放必要的端口
   - 考虑使用 VPN 或内网访问
3. **数据隐私**

   - 摄像头数据仅在本地处理
   - 不涉及数据上传或存储
