
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>机器学习平台 API 文档</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        h3 {
            color: #7f8c8d;
        }
        code {
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            color: inherit;
        }
        blockquote {
            border-left: 4px solid #3498db;
            margin: 0;
            padding-left: 20px;
            color: #7f8c8d;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: center;
            color: #7f8c8d;
        }
        .nav-links {
            margin-bottom: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 6px;
        }
        .nav-links a {
            color: #3498db;
            text-decoration: none;
            margin-right: 20px;
        }
        .nav-links a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-links">
            <a href="#overview">概述</a>
            <a href="#auth">认证</a>
            <a href="#scan">扫描</a>
            <a href="#ml">机器学习</a>
            <a href="#health">健康检查</a>
            <a href="http://localhost:8000/docs" target="_blank">Swagger UI</a>
            <a href="http://localhost:8000/redoc" target="_blank">ReDoc</a>
        </div>
        
        <h1 id="api">机器学习平台 API 文档</h1>
<blockquote>
<p>基于 FastAPI。所有 JSON 响应字段以实际接口返回为准。本文档仅列出主要稳定端点与示例。</p>
</blockquote>
<h2 id="auth">认证与用户（/auth）</h2>
<ul>
<li>POST <code>/auth/send-verification-code</code></li>
<li>描述：发送邮箱验证码（后台任务发邮件，验证码有效期见服务端配置）</li>
<li>请求体（application/json）：
    <code>json
    { "email": "user@example.com" }</code></li>
<li>
<p>响应：
    <code>json
    { "message": "验证码已发送，请查收邮件" }</code></p>
</li>
<li>
<p>POST <code>/auth/login</code></p>
</li>
<li>描述：使用邮箱验证码登录（校验成功后重定向到前端 <code>features</code> 页面携带 token）。</li>
<li>请求体（application/json）：
    <code>json
    { "email": "user@example.com", "verification_code": "123456" }</code></li>
<li>
<p>响应（302 重定向）：Location: <code>{FRONTEND_URL}/features?token=...</code></p>
</li>
<li>
<p>GET <code>/auth/github/login</code></p>
</li>
<li>
<p>描述：GitHub OAuth 登录入口（302 跳转至 GitHub 授权页）。</p>
</li>
<li>
<p>GET <code>/auth/github/callback?code=xxx</code></p>
</li>
<li>
<p>描述：GitHub 回调；成功后 302 跳转到 <code>{FRONTEND_URL}/features?token=...</code></p>
</li>
<li>
<p>GET <code>/auth/me</code></p>
</li>
<li>描述：获取当前登录用户信息</li>
<li>认证：Bearer Token（来自登录流程生成的 JWT）</li>
<li>响应：
    <code>json
    { "id": 1, "email": "user@example.com", "is_active": true }</code></li>
</ul>
<h2 id="_1">通用与页面路由</h2>
<ul>
<li>GET <code>/</code>、<code>/login</code></li>
<li>
<p>描述：返回登录页面（HTML）。</p>
</li>
<li>
<p>GET <code>/features?token=...</code></p>
</li>
<li>
<p>描述：返回功能入口页面（HTML）。</p>
</li>
<li>
<p>GET <code>/ml-features?token=...</code></p>
</li>
<li>
<p>描述：返回 ML 功能页面（HTML）。</p>
</li>
<li>
<p>Streamlit 应用跳转（要求 query 中携带 token）：</p>
</li>
<li>GET <code>/knn</code> → 302 到 <code>/knn/?token=...</code></li>
<li>GET <code>/kmeans</code> → 302 到 <code>/kmeans/?token=...</code></li>
<li>GET <code>/linear-regression</code> → 302 到 <code>/linear/?token=...</code></li>
<li>GET <code>/logistic-regression</code> → 302 到 <code>/logistic/?token=...</code></li>
<li>
<p>GET <code>/random-forest</code> → 302 到 <code>/forest/?token=...</code></p>
</li>
<li>
<p>GET <code>/start-streamlit-apps</code></p>
</li>
<li>描述：后台线程启动所有 Streamlit 子应用。</li>
<li>响应：
    <code>json
    { "message": "Streamlit应用已启动" }</code></li>
</ul>
<h2 id="health">健康检查（/health）</h2>
<ul>
<li>GET <code>/health</code></li>
<li>描述：容器/服务健康状态探针</li>
<li>响应：
    <code>json
    { "status": "healthy", "color": "blue", "version": "1.0.0" }</code></li>
</ul>
<h2 id="api-apiscan">文档扫描与图像处理（/api | /api/scan）</h2>
<ul>
<li>POST <code>/api/scan</code></li>
<li>描述：上传图片并进行文档扫描/处理。</li>
<li>请求：multipart/form-data，字段名 <code>file</code></li>
<li>响应（成功示例）：
    <code>json
    {
      "original_image": "/static/uploads/original_20250101010101.jpg",
      "processed_image": "/static/processed/processed_xxx.jpg",
      "message": "Document processed successfully"
    }</code></li>
<li>
<p>失败返回：HTTP 4xx/5xx，含 <code>detail</code> 或 <code>error</code> 字段。</p>
</li>
<li>
<p>GET <code>/api/image/{filename:path}</code></p>
</li>
<li>
<p>描述：按路径返回静态图像文件。</p>
</li>
<li>
<p>附：页面端上传表单</p>
</li>
<li>GET <code>/scan</code> 返回上传页（HTML）</li>
<li>GET <code>/scan-form</code> 返回另一上传页面（HTML）</li>
</ul>
<h2 id="apiml">机器学习 API（/ml）</h2>
<p>说明：所有 <code>/ml/**</code> 端点均要求 Bearer Token（来自登录流程的 JWT）。部分训练/预测依赖预先保存的模型与 scaler，路径由配置 <code>MODEL_SAVE_PATH</code> 决定。</p>
<ul>
<li>训练</li>
<li>POST <code>/ml/knn/train</code><ul>
<li>query/body 参数：<code>n_neighbors</code>（默认 5）</li>
<li>响应：<code>{"message": "KNN model trained successfully"}</code></li>
</ul>
</li>
<li>POST <code>/ml/kmeans/train</code><ul>
<li>参数：<code>n_clusters</code>（默认 3）</li>
<li>响应：<code>{"message": "KMeans model trained successfully"}</code></li>
</ul>
</li>
<li>POST <code>/ml/logistic_regression/train</code><ul>
<li>参数：<code>epochs</code>（默认 1000）、<code>lr</code>（默认 0.01）</li>
<li>响应：<code>{"message": "Logistic Regression model trained successfully"}</code></li>
</ul>
</li>
<li>POST <code>/ml/linear_regression/train</code><ul>
<li>参数：<code>epochs</code>（默认 1000）、<code>lr</code>（默认 0.01）</li>
<li>响应：<code>{"message": "Linear Regression model trained successfully"}</code></li>
</ul>
</li>
<li>
<p>POST <code>/ml/random_forest/train</code></p>
<ul>
<li>参数：<code>epochs</code>（默认 100）、<code>lr</code>（默认 0.01）</li>
<li>响应：<code>{"message": "Random Forest model trained successfully"}</code></li>
</ul>
</li>
<li>
<p>预测（均为 <code>multipart/form-data</code>，字段名 <code>file</code>，内容为 CSV）</p>
</li>
<li>POST <code>/ml/knn/predict</code><ul>
<li>响应：<code>{"predictions": [0,1,1,...]}</code></li>
</ul>
</li>
<li>POST <code>/ml/kmeans/predict</code><ul>
<li>响应：<code>{"clusters": [0,2,1,...]}</code></li>
</ul>
</li>
<li>POST <code>/ml/logistic_regression/predict</code><ul>
<li>响应：<code>{"predictions": [0,1,0,...]}</code></li>
</ul>
</li>
<li>POST <code>/ml/linear_regression/predict</code><ul>
<li>响应：<code>{"predictions": [3.14, 2.71, ...]}</code></li>
</ul>
</li>
<li>POST <code>/ml/random_forest/predict</code><ul>
<li>响应：
  <code>json
  {
    "predictions": [0, 2, 1, ...],
    "class_names": ["setosa", "versicolor", "virginica"]
  }</code></li>
</ul>
</li>
</ul>
<h2 id="_2">静态资源</h2>
<ul>
<li>GET <code>/static/...</code></li>
<li>描述：静态文件（上传文件、处理结果、前端资源等）。</li>
</ul>
<h2 id="jwt">认证说明（JWT）</h2>
<ul>
<li>获取方式：通过 <code>/auth/login</code>（邮箱验证码）或 GitHub OAuth 登录成功后由后端签发。</li>
<li>用法：在需要鉴权的接口（如 <code>/ml/**</code>）请求头携带：
  <code>http
  Authorization: Bearer &lt;JWT_TOKEN&gt;</code></li>
</ul>
<h2 id="_3">错误响应格式</h2>
<ul>
<li>FastAPI 默认错误：
  <code>json
  { "detail": "错误描述" }</code></li>
<li>项目中部分接口也可能返回：
  <code>json
  { "error": "错误描述" }</code></li>
</ul>
<h2 id="curl">示例：curl 请求</h2>
<ul>
<li>
<p>发送验证码：
  <code>bash
  curl -X POST http://localhost:8000/auth/send-verification-code \
       -H "Content-Type: application/json" \
       -d '{"email":"user@example.com"}'</code></p>
</li>
<li>
<p>扫描文件：
  <code>bash
  curl -X POST http://localhost:8000/api/scan \
       -F file=@/path/to/image.jpg</code></p>
</li>
<li>
<p>训练 KNN：
  <code>bash
  curl -X POST "http://localhost:8000/ml/knn/train?n_neighbors=5" \
       -H "Authorization: Bearer $TOKEN"</code></p>
</li>
<li>
<p>预测 KMeans：
  <code>bash
  curl -X POST http://localhost:8000/ml/kmeans/predict \
       -H "Authorization: Bearer $TOKEN" \
       -F file=@/path/to/data.csv</code></p>
</li>
</ul>
        
        <div class="footer">
            <p>机器学习平台 API 文档 | 生成时间: 2025-09-24 18:37:32</p>
            <p>交互式文档: <a href="http://localhost:8000/docs">Swagger UI</a> | <a href="http://localhost:8000/redoc">ReDoc</a></p>
        </div>
    </div>
</body>
</html>
        